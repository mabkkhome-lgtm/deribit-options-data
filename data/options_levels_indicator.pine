//@version=5
indicator("Options Levels", overlay=true, max_lines_count=10)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// OPTIONS LEVELS TRACKER
// Draws support and resistance lines based on options flow data
// Update values manually or use Tampermonkey script for auto-updates
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Main Inputs - These get updated by Tampermonkey script
float resistance = input.float(89329, "Resistance (Today)", group="ğŸ“Š Current Levels")
float support = input.float(84307, "Support (Today)", group="ğŸ“Š Current Levels")

// Visual Settings
color resistanceColor = input.color(#26a69a, "Resistance Color", group="ğŸ¨ Appearance")
color supportColor = input.color(#ef5350, "Support Color", group="ğŸ¨ Appearance")
color zoneColor = input.color(color.new(#2962ff, 85), "Zone Color", group="ğŸ¨ Appearance")
int lineWidth = input.int(2, "Line Width", minval=1, maxval=5, group="ğŸ¨ Appearance")

// Display Options
bool showLines = input.bool(true, "Show Lines", group="âš™ï¸ Display")
bool showZone = input.bool(true, "Show Zone", group="âš™ï¸ Display")
bool showLabels = input.bool(true, "Show Labels", group="âš™ï¸ Display")
bool showTable = input.bool(true, "Show Info Table", group="âš™ï¸ Display")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DRAWING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Draw horizontal lines
var line resistanceLine = na
var line supportLine = na
var box zoneBox = na
var label resistanceLabel = na
var label supportLabel = na

if barstate.islast and showLines
    // Delete old drawings
    line.delete(resistanceLine)
    line.delete(supportLine)
    box.delete(zoneBox)
    label.delete(resistanceLabel)
    label.delete(supportLabel)
    
    // Calculate bar positions
    int leftBar = bar_index - 200
    int rightBar = bar_index + 50
    
    // Draw resistance line
    resistanceLine := line.new(leftBar, resistance, rightBar, resistance, 
         color=resistanceColor, width=lineWidth, style=line.style_solid, extend=extend.right)
    
    // Draw support line
    supportLine := line.new(leftBar, support, rightBar, support, 
         color=supportColor, width=lineWidth, style=line.style_solid, extend=extend.right)
    
    // Draw zone
    if showZone
        zoneBox := box.new(leftBar, resistance, rightBar, support, 
             border_color=color.new(zoneColor, 100), bgcolor=zoneColor, extend=extend.right)
    
    // Draw labels
    if showLabels
        resistanceLabel := label.new(rightBar, resistance, "R: " + str.tostring(resistance, "#"),
             color=resistanceColor, textcolor=color.white, style=label.style_label_left, size=size.normal)
        supportLabel := label.new(rightBar, support, "S: " + str.tostring(support, "#"),
             color=supportColor, textcolor=color.white, style=label.style_label_left, size=size.normal)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INFO TABLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

if showTable and barstate.islast
    var table infoTable = table.new(position.top_right, 2, 5, 
         bgcolor=color.new(#1e222d, 5), border_width=1, border_color=color.new(#363a45, 0))
    
    // Header
    table.cell(infoTable, 0, 0, "ğŸ“Š Options Levels", text_color=#d1d4dc, text_size=size.small, bgcolor=color.new(#2962ff, 20))
    table.merge_cells(infoTable, 0, 0, 1, 0)
    
    // Resistance
    table.cell(infoTable, 0, 1, "Resistance", text_color=#787b86, text_size=size.small)
    table.cell(infoTable, 1, 1, str.tostring(resistance, "#"), text_color=resistanceColor, text_size=size.small)
    
    // Support
    table.cell(infoTable, 0, 2, "Support", text_color=#787b86, text_size=size.small)
    table.cell(infoTable, 1, 2, str.tostring(support, "#"), text_color=supportColor, text_size=size.small)
    
    // Range
    table.cell(infoTable, 0, 3, "Range", text_color=#787b86, text_size=size.small)
    table.cell(infoTable, 1, 3, str.tostring(resistance - support, "#"), text_color=#ffd600, text_size=size.small)
    
    // Position
    float position = (close - support) / (resistance - support) * 100
    string posText = position > 66 ? "ğŸ”´ Near R" : position < 33 ? "ğŸŸ¢ Near S" : "âšª Mid"
    table.cell(infoTable, 0, 4, "Position", text_color=#787b86, text_size=size.small)
    table.cell(infoTable, 1, 4, posText + " " + str.tostring(position, "#.#") + "%", text_color=#d1d4dc, text_size=size.small)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ALERTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

bool crossAboveResistance = ta.crossover(close, resistance)
bool crossBelowSupport = ta.crossunder(close, support)

alertcondition(crossAboveResistance, title="Break Above Resistance", message="BTC crossed above resistance at {{close}}")
alertcondition(crossBelowSupport, title="Break Below Support", message="BTC dropped below support at {{close}}")
