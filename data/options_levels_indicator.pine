// Options Levels Tracker - Auto-Generated with 128 days of historical data
// Last Updated: 2025-12-19 11:27 UTC
// To get the latest version: https://github.com/mabkkhome-lgtm/deribit-options-data/blob/main/data/options_levels_indicator.pine

//@version=5
indicator("Options Levels Tracker", overlay=true, max_lines_count=500, max_labels_count=50, max_boxes_count=50)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EMBEDDED HISTORICAL DATA (128 days)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var array<string> DATA_DATES = array.from("10/08/2025", "11/08/2025", "12/08/2025", "13/08/2025", "15/08/2025", "16/08/2025", "17/08/2025", "18/08/2025", "19/08/2025", "20/08/2025", "21/08/2025", "22/08/2025", "23/08/2025", "24/08/2025", "25/08/2025", "26/08/2025", "27/08/2025", "28/08/2025", "29/08/2025", "30/08/2025", "31/08/2025", "01/09/2025", "02/09/2025", "03/09/2025", "04/09/2025", "05/09/2025", "06/09/2025", "07/09/2025", "08/09/2025", "09/09/2025", "10/09/2025", "11/09/2025", "12/09/2025", "13/09/2025", "14/09/2025", "15/09/2025", "16/09/2025", "17/09/2025", "18/09/2025", "19/09/2025", "20/09/2025", "21/09/2025", "22/09/2025", "23/09/2025", "24/09/2025", "25/09/2025", "26/09/2025", "27/09/2025", "29/09/2025", "30/09/2025", "01/10/2025", "02/10/2025", "03/10/2025", "04/10/2025", "05/10/2025", "06/10/2025", "07/10/2025", "08/10/2025", "09/10/2025", "10/10/2025", "11/10/2025", "12/10/2025", "13/10/2025", "14/10/2025", "15/10/2025", "16/10/2025", "17/10/2025", "18/10/2025", "19/10/2025", "20/10/2025", "21/10/2025", "22/10/2025", "23/10/2025", "24/10/2025", "25/10/2025", "26/10/2025", "27/10/2025", "28/10/2025", "29/10/2025", "30/10/2025", "31/10/2025", "01/11/2025", "02/11/2025", "03/11/2025", "04/11/2025", "05/11/2025", "06/11/2025", "07/11/2025", "08/11/2025", "09/11/2025", "10/11/2025", "11/11/2025", "12/11/2025", "13/11/2025", "14/11/2025", "15/11/2025", "16/11/2025", "17/11/2025", "18/11/2025", "19/11/2025", "20/11/2025", "21/11/2025", "23/11/2025", "24/11/2025", "25/11/2025", "26/11/2025", "27/11/2025", "29/11/2025", "30/11/2025", "01/12/2025", "02/12/2025", "03/12/2025", "04/12/2025", "05/12/2025", "06/12/2025", "08/12/2025", "09/12/2025", "10/12/2025", "11/12/2025", "12/12/2025", "13/12/2025", "14/12/2025", "15/12/2025", "16/12/2025", "17/12/2025", "18/12/2025", "19/12/2025", "20/12/2025")
var array<float> DATA_HIGHS = array.from(117200, 118700, 123750, 123350, 118720, 119800, 119103, 116000, 117400, 118250, 115200, 117400, 115650, 116660, 115600, 113800, 112890, 113166, 114150, 112150, 110345, 110476, 110840, 111444, 112362, 112240, 114000, 111689, 112900, 113400, 113500, 114800, 117800, 116165, 117254, 116300, 116674, 116342, 118419, 117760, 118190, 116570, 117240, 115150, 114080, 117900, 113480, 110900, 110050, 122000, 115000, 116870, 119400, 121500, 123180, 125890, 125450, 126000, 124200, 124100, 123400, 115000, 118730, 118900, 115500, 114330, 115450, 110900, 108320, 108990, 112700, 111380, 110720, 117610, 113300, 112450, 114046, 116450, 116830, 116800, 117630, 112940, 111049, 112560, 109960, 107380, 105000, 106000, 103500, 103394, 103680, 107621, 107160, 105570, 106800, 102900, 96930, 98110, 97670, 95640, 94650, 96850, 86500, 89025, 89130, 90500, 89300, 93450, 91800, 92740, 89400, 90050, 94840, 95200, 93620, 91375, 93600, 92300, 95280, 92100, 94290, 91390, 92020, 90000, 88160, 89170, 90320, 89329)
var array<float> DATA_LOWS = array.from(113800, 113650, 118500, 118720, 118500, 116800, 116000, 115760, 113400, 112800, 111220, 112600, 109660, 114640, 111800, 109700, 108300, 109600, 110250, 108724, 107500, 107500, 106830, 108160, 109500, 108900, 108950, 109880, 109300, 111430, 108900, 112010, 111010, 110600, 114923, 111700, 113300, 113200, 107718, 109970, 115800, 114843, 114270, 111000, 110900, 111650, 109480, 108130, 108525, 111686, 110365, 113430, 114400, 117400, 121214, 121155, 119520, 122162, 120227, 119300, 117940, 110177, 113250, 113000, 109500, 109817, 109550, 103500, 105430, 104700, 106600, 105370, 105400, 108920, 107930, 110330, 110633, 107430, 112620, 108900, 107950, 106600, 108025, 108838, 105700, 102080, 98870, 99680, 98500, 101666, 99460, 102355, 102500, 101300, 101500, 95450, 94430, 93679, 92119, 88530, 89000, 90063, 83000, 83716, 83860, 85300, 84900, 89525, 89860, 89600, 84800, 84700, 88740, 90100, 89820, 87360, 89500, 88470, 88980, 88500, 90030, 89540, 87920, 86600, 83800, 85920, 84480, 84307)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// OPTIONAL: Override today's data (for real-time updates)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

bool useOverride = input.bool(false, "Use Manual Override for Today", group="ğŸ“Š Manual Override")
float overrideHigh = input.float(89329, "Today's Resistance", group="ğŸ“Š Manual Override")
float overrideLow = input.float(84307, "Today's Support", group="ğŸ“Š Manual Override")
string overrideDate = input.string("20/12/2025", "Today's Date (dd/mm/yyyy)", group="ğŸ“Š Manual Override")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ANALYSIS PERIODS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

int shortPeriod = input.int(7, "Short Period (days)", minval=1, maxval=30, group="ğŸ“ˆ Analysis Periods")
int longPeriod = input.int(30, "Long Period (days)", minval=7, maxval=90, group="ğŸ“ˆ Analysis Periods")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SETTINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

string showOn = input.string("BTCUSDT", "Chart Symbol", group="âš™ï¸ Settings")

// Visual Styles
color topColor = input.color(#00ff00, "Resistance", inline="c1", group="âš™ï¸ Settings")
color lowColor = input.color(#ff0000, "Support", inline="c2", group="âš™ï¸ Settings")
color zoneColor = input.color(color.new(#2962ff, 90), "Zone Fill", inline="c2", group="âš™ï¸ Settings")

int lineThickness = input.int(2, "Line Width", minval=1, maxval=5, group="âš™ï¸ Settings")
string lineStyle = input.string("Solid", "Line Style", options=["Solid", "Dashed", "Dotted"], group="âš™ï¸ Settings")

// Features
bool showLabels = input.bool(true, "Show Labels (Latest Only)", group="âš™ï¸ Settings")
bool showPrices = input.bool(true, "Show Prices", group="âš™ï¸ Settings")
bool showZones = input.bool(true, "Support/Resistance Zones", group="âš™ï¸ Settings")
bool showStats = input.bool(true, "Statistics Panel", group="âš™ï¸ Settings")

// Table Options
string tablePosition = input.string("Bottom Right", "Table Position", options=["Top Right", "Top Left", "Bottom Right", "Bottom Left"], group="ğŸ“Š Table Settings")
string tableTextSize = input.string("Small", "Table Font Size", options=["Tiny", "Small", "Normal", "Large"], group="ğŸ“Š Table Settings")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CORE LOGIC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

bool show = syminfo.ticker == showOn
string pineLineStyle = lineStyle == "Dashed" ? line.style_dashed : lineStyle == "Dotted" ? line.style_dotted : line.style_solid

// Parse date string to timestamp
parseDate(dateStr) =>
    array<string> parts = str.split(dateStr, "/")
    if array.size(parts) == 3
        int dd = int(str.tonumber(array.get(parts, 0)))
        int mm = int(str.tonumber(array.get(parts, 1)))
        int yy = int(str.tonumber(array.get(parts, 2)))
        if yy < 100
            yy := yy + 2000
        timestamp(yy, mm, dd, 0, 0, 0)
    else
        na

// Get data for drawing
getData() =>
    int dataSize = array.size(DATA_DATES)
    array<string> dates = array.copy(DATA_DATES)
    array<float> highs = array.copy(DATA_HIGHS)
    array<float> lows = array.copy(DATA_LOWS)
    
    // Add override if enabled
    if useOverride
        array.push(dates, overrideDate)
        array.push(highs, overrideHigh)
        array.push(lows, overrideLow)
    
    [dates, highs, lows]

// Statistics variables
var float todayRange = na
var float lastTop = na
var float lastLow = na

// Draw levels
if barstate.islast and show
    [dates, highs, lows] = getData()
    int dataSize = array.size(dates)
    
    if dataSize > 0
        var float prevTop = na
        var float prevLow = na
        var int prevTs = na
        
        string labelSize = tableTextSize == "Tiny" ? size.tiny : tableTextSize == "Small" ? size.small : tableTextSize == "Large" ? size.large : size.normal
        
        for i = 0 to dataSize - 1
            string dateStr = array.get(dates, i)
            float topVal = array.get(highs, i)
            float lowVal = array.get(lows, i)
            int anchorTs = parseDate(dateStr)
            
            if not na(anchorTs) and not na(topVal) and not na(lowVal)
                int boxStart = anchorTs - (24 * 60 * 60 * 1000)
                
                // Draw zone
                if showZones
                    box.new(boxStart, topVal, anchorTs, lowVal, xloc=xloc.bar_time, border_color=color.new(zoneColor, 100), bgcolor=zoneColor)
                
                // Draw connecting lines
                if not na(prevTs)
                    line.new(prevTs, prevTop, anchorTs, topVal, xloc=xloc.bar_time, color=topColor, width=lineThickness, style=pineLineStyle)
                    line.new(prevTs, prevLow, anchorTs, lowVal, xloc=xloc.bar_time, color=lowColor, width=lineThickness, style=pineLineStyle)
                
                // Labels on last point only
                if i == dataSize - 1 and showLabels
                    string topText = showPrices ? "R: " + str.tostring(topVal) : "R"
                    string lowText = showPrices ? "S: " + str.tostring(lowVal) : "S"
                    label.new(anchorTs, topVal, topText, xloc=xloc.bar_time, color=topColor, textcolor=color.white, style=label.style_label_left, size=labelSize == size.tiny ? size.tiny : labelSize == size.small ? size.small : labelSize == size.large ? size.large : size.normal)
                    label.new(anchorTs, lowVal, lowText, xloc=xloc.bar_time, color=lowColor, textcolor=color.white, style=label.style_label_left, size=labelSize == size.tiny ? size.tiny : labelSize == size.small ? size.small : labelSize == size.large ? size.large : size.normal)
                    
                    lastTop := topVal
                    lastLow := lowVal
                    todayRange := topVal - lowVal
                
                prevTop := topVal
                prevLow := lowVal
                prevTs := anchorTs

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATISTICS PANEL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

if showStats and barstate.islast and show
    var positionSetting = tablePosition == "Top Right" ? position.top_right : tablePosition == "Top Left" ? position.top_left : tablePosition == "Bottom Left" ? position.bottom_left : position.bottom_right
    var tableSize = tableTextSize == "Tiny" ? size.tiny : tableTextSize == "Normal" ? size.normal : tableTextSize == "Large" ? size.large : size.small
    
    var table statsTable = table.new(positionSetting, 2, 6, bgcolor=color.new(#1a1a1a, 5), border_width=2, border_color=color.new(#333333, 0))
    
    table.cell(statsTable, 0, 0, "ğŸ“Š Options Levels", text_color=color.new(#ffffff, 0), text_size=tableSize, bgcolor=color.new(#2962ff, 20))
    table.merge_cells(statsTable, 0, 0, 1, 0)
    
    if not na(lastTop)
        table.cell(statsTable, 0, 1, "Resistance", text_color=color.new(#cccccc, 0), text_size=tableSize, text_halign=text.align_left)
        table.cell(statsTable, 1, 1, str.tostring(math.round(lastTop, 0)), text_color=color.new(#4caf50, 0), text_size=tableSize, text_halign=text.align_right)
    
    if not na(lastLow)
        table.cell(statsTable, 0, 2, "Support", text_color=color.new(#cccccc, 0), text_size=tableSize, text_halign=text.align_left)
        table.cell(statsTable, 1, 2, str.tostring(math.round(lastLow, 0)), text_color=color.new(#f44336, 0), text_size=tableSize, text_halign=text.align_right)
    
    if not na(todayRange)
        table.cell(statsTable, 0, 3, "Range", text_color=color.new(#cccccc, 0), text_size=tableSize, text_halign=text.align_left)
        table.cell(statsTable, 1, 3, str.tostring(math.round(todayRange, 0)), text_color=color.new(#ffeb3b, 0), text_size=tableSize, text_halign=text.align_right)
    
    if not na(lastTop) and not na(lastLow)
        float pricePos = (close - lastLow) / (lastTop - lastLow) * 100
        string posText = pricePos > 66 ? "ğŸ”´ Near R" : pricePos < 33 ? "ğŸŸ¢ Near S" : "âšª Mid"
        table.cell(statsTable, 0, 4, "Position", text_color=color.new(#cccccc, 0), text_size=tableSize, text_halign=text.align_left)
        table.cell(statsTable, 1, 4, posText + " " + str.tostring(math.round(pricePos, 1)) + "%", text_color=color.new(#ffeb3b, 0), text_size=tableSize, text_halign=text.align_right)
    
    table.cell(statsTable, 0, 5, "Data: " + str.tostring(array.size(DATA_DATES)) + " days", text_color=color.new(#4caf50, 0), text_size=tableSize, text_halign=text.align_center, bgcolor=color.new(#1b5e20, 30))
    table.merge_cells(statsTable, 0, 5, 1, 5)
